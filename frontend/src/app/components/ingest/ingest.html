<div class="ingest-container">
  <section class="upload-card">
    <h2>Ingestion de documents</h2>
    <p>Ajoutez un fichier Markdown ou texte pour enrichir la base de connaissances.</p>

    <div class="drop-zone" [class.has-file]="selectedFile()">
      <input
        type="file"
        id="fileInput"
        accept=".md,.txt"
        (change)="onFileSelected($event)"
        [disabled]="isUploading()"
      />
      <label for="fileInput">
        @if (selectedFile()) {
          <span class="file-name">{{ selectedFile()!.name }}</span>
          <span class="file-hint">Cliquer pour changer</span>
        } @else {
          <span class="drop-icon">⊕</span>
          <span class="drop-label">Sélectionner un fichier .md / .txt</span>
        }
      </label>
    </div>

    <button class="btn-ingest" (click)="uploadFile()" [disabled]="!selectedFile() || isUploading()">
      @if (isUploading()) {
        <span class="spinner"></span> Envoi…
      } @else {
        Ingérer
      }
    </button>

    @if (successMsg()) {
      <div class="alert success">{{ successMsg() }}</div>
    }
    @if (error()) {
      <div class="alert error">{{ error() }}</div>
    }
  </section>

  <section class="doc-list">
    <h3>
      Base de connaissances <span class="count">{{ documents().length }}</span>
    </h3>

    @if (isLoadingDocs()) {
      <p class="muted">Chargement…</p>
    } @else if (documents().length === 0) {
      <p class="muted">Aucun document ingéré.</p>
    } @else {
      <ul>
        @for (doc of documents(); track doc.id) {
          <li>
            <span class="doc-name">{{ doc.filename }}</span>
            <span class="doc-chunks">{{ doc.chunks_count }} chunks</span>
          </li>
        }
      </ul>
    }
  </section>
</div>
